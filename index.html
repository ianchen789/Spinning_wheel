<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥è½‰è½‰æ¨‚</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
            overflow-x: hidden;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .panel {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            flex: 1 1 300px;
            min-width: 280px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            position: relative;
        }

        .panel h2 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .wheel-panel {
            flex: 1 1 400px;
            min-width: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        #wheelCanvas {
            width: 100%;
            max-width: 400px;
            height: auto;
            aspect-ratio: 1 / 1;
            border: 5px solid #3498db;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            background-color: #ecf0f1;
            transform: rotate(0deg);
        }

        .spin-button {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background-color: #28a745;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .spin-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        .spin-button:active {
            background-color: #1e7e34;
            transform: translateY(0);
        }

        .spin-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .entry-list {
            margin-top: 15px;
            width: 100%;
        }

        .entry-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #eee;
            gap: 8px;
            font-size: 0.95em;
        }

        .entry-item label {
            min-width: 35px;
            font-weight: bold;
            color: #555;
            white-space: nowrap;
        }

        /* èª¿æ•´è¼¸å…¥æ•¸å€¼å’Œæ–‡å­—æ¡†å¤§å° */
        .entry-item input[type="number"] {
            width: 45px; /* è¨­ç½®ä¸€å€‹å›ºå®šçš„è¼ƒå°å¯¬åº¦ */
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒå¢åŠ ç¸½å¯¬åº¦ */
        }

        .entry-item input[type="text"] {
            flex: 1; /* ä½”æ“šå‰©é¤˜æ‰€æœ‰ç©ºé–“ */
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-width: 80px; /* ç¢ºä¿åœ¨å°è¢å¹•ä¸‹æ–‡å­—æ¡†ä¸è‡³æ–¼å¤ªå° */
            box-sizing: border-box;
        }

        .entry-item button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            white-space: nowrap; /* é˜²æ­¢åˆªé™¤æŒ‰éˆ•æ–‡å­—æ›è¡Œ */
        }

        .entry-item button:hover {
            background-color: #c0392b;
        }

        .add-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s ease;
            width: 100%;
        }

        .add-button:hover {
            background-color: #2980b9;
        }

        /* æŒ‡é‡æ¨£å¼ */
        .pointer {
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 25px solid #e74c3c;
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .settings-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .settings-item {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
        }

        .settings-item label {
            font-weight: bold;
            color: #555;
            min-width: 70px;
        }

        .settings-item input[type="number"] {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 80px;
        }

        /* å½©å¸¶å‹•ç•« */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: red;
            animation: confetti-fall 3s forwards ease-out;
            opacity: 0;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotateZ(720deg);
                opacity: 0;
            }
        }

        /* è½‰ç›¤å‹•ç•«çš„CSS */
        #wheelCanvas.spinning {
            transition: transform var(--spin-duration) cubic-bezier(0.1, 0.5, 0, 1);
            transform: rotate(var(--end-rotation));
        }
        
        /* å½ˆå‡ºçµæœè¦–çª— */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            text-align: center;
            position: relative;
            max-width: 90%;
            transform: scale(0.8);
            opacity: 0;
            animation: modal-fade-in 0.3s forwards ease-out;
        }

        @keyframes modal-fade-in {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
        }

        .modal-title {
            font-size: 2.5em;
            color: #28a745;
            margin-bottom: 15px;
        }

        .modal-result-text {
            font-size: 3.5em;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 25px;
            word-wrap: break-word;
            max-width: 100%;
        }

        .modal-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .modal-button:hover {
            background-color: #2980b9;
        }
        
        /* å¡ç‰‡é¢æ¿ */
        .card-panel {
            flex: 1 1 300px;
            min-width: 280px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .card-panel .reset-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #607d8b;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .card-panel .reset-button:hover {
            background-color: #455a64;
        }

        .card-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .card-item {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .card-item h3 {
            color: #2e7d32;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .card-item p {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 15px;
        }

        .card-use-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .card-use-button:hover {
            background-color: #43A047;
        }

        .card-use-button:disabled {
            background-color: #b0c9b0;
            cursor: not-allowed;
            color: #666;
        }

        .card-item span {
            font-weight: bold;
            color: #00796b;
        }

        /* å¡ç‰‡æ“ä½œé¸æ“‡å™¨ */
        .card-selection-modal {
            background-color: #e0f7fa;
            border: 1px solid #b2ebf2;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }
        .card-selection-modal h4 {
            color: #00796b;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .card-selection-modal select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #b2ebf2;
            border-radius: 5px;
        }
        .card-selection-modal button {
            background-color: #00bcd4;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.3s ease;
        }
        .card-selection-modal button:hover {
            background-color: #0097a7;
        }


        /* åª’é«”æŸ¥è©¢ï¼šé‡å°å°è¢å¹•è¨­å‚™é€²ä¸€æ­¥èª¿æ•´ */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
                margin-bottom: 20px;
            }
            .container {
                flex-direction: column;
                gap: 15px;
            }
            .panel {
                padding: 15px;
                flex: 1 1 auto;
                max-height: none;
                overflow-y: visible;
            }
            .wheel-panel {
                min-width: 280px;
            }
            #wheelCanvas {
                max-width: 300px;
            }
            .spin-button {
                padding: 10px 20px;
                font-size: 16px;
            }
            .entry-item {
                font-size: 0.9em;
                padding: 6px 10px;
            }
            .entry-item input[type="number"] {
                width: 40px; /* åœ¨å°è¢å¹•ä¸‹é€²ä¸€æ­¥ç¸®å° */
            }
            .entry-item input[type="text"] {
                min-width: 60px; /* åœ¨å°è¢å¹•ä¸‹ä¹Ÿç¢ºä¿å¯è®€æ€§ */
            }
            .pointer {
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                border-top: 20px solid #e74c3c;
                top: 10px;
            }
            .modal-content {
                padding: 25px;
            }
            .modal-title {
                font-size: 2em;
            }
            .modal-result-text {
                font-size: 3em;
            }
            .card-panel {
                max-height: none;
                overflow-y: visible;
                margin-top: 15px;
            }
            .card-item h3 {
                font-size: 1.2em;
            }
            .card-item p {
                font-size: 0.85em;
            }
            .card-use-button {
                padding: 6px 12px;
                font-size: 0.85em;
            }
             .card-panel .reset-button {
                top: 10px;
                right: 10px;
                padding: 6px 10px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>

    <h1>ç”Ÿæ—¥è½‰è½‰æ¨‚</h1>

    <div class="container">
        <div class="panel controls-panel">
            <h2>è½‰ç›¤å€åŸŸè¨­å®š</h2>
            <div id="entries" class="entry-list">
                </div>
            <button class="add-button" onclick="addEntry()">+ æ–°å¢å€åŸŸ</button>

            <div class="settings-section">
                <h2>é¡å¤–è¨­å®š</h2>
                <div class="settings-item">
                    <label for="spinCount">æ—‹è½‰åœˆæ•¸:</label>
                    <input type="number" id="spinCount" value="5" min="1">
                </div>
                <div class="settings-item">
                    <label for="spinDuration">æ—‹è½‰æ™‚é–“ (ç§’):</label>
                    <input type="number" id="spinDuration" value="5" min="1" step="0.5">
                </div>
            </div>
        </div>

        <div class="panel wheel-panel">
            <div style="position: relative;">
                <canvas id="wheelCanvas" width="500" height="500"></canvas>
                <div class="pointer"></div>
            </div>
            <button class="spin-button" id="spinButton">æ—‹è½‰ï¼</button>
        </div>

        <div class="panel card-panel">
            <h2>åŠŸèƒ½å¡ç‰‡å¤¾</h2>
            <button class="reset-button" onclick="resetCards()">é‡ç½®å¡ç‰‡</button>
            <div class="card-list">
                <div class="card-item" id="respinCard">
                    <h3>ğŸ”„ é‡å•Ÿè½‰å‹•å¡</h3>
                    <p>è½‰ç›¤åœä¸‹å¾Œï¼Œå†è½‰ä¸€æ¬¡ï¼</p>
                    <button class="card-use-button" onclick="useRespinCard()">ä½¿ç”¨ (<span id="respinCardCount">1</span>)</button>
                </div>
                <div class="card-item" id="boostCard">
                    <h3>ğŸ“ˆ æ©Ÿç‡æå‡å¡</h3>
                    <p>æš«æ™‚å¢åŠ æŒ‡å®šå€åŸŸçš„æ©Ÿç‡ã€‚</p>
                    <button class="card-use-button" onclick="useBoostCard()">ä½¿ç”¨ (<span id="boostCardCount">1</span>)</button>
                </div>
                <div class="card-item" id="removeCard">
                    <h3>âŒ åˆªé™¤å€å¡Šå¡</h3>
                    <p>æš«æ™‚ç§»é™¤ä¸€å€‹æŒ‡å®šå€å¡Šã€‚</p>
                    <button class="card-use-button" onclick="useRemoveCard()">ä½¿ç”¨ (<span id="removeCardCount">1</span>)</button>
                </div>
            </div>
            <div class="card-selection-modal" id="boostTargetSelection" style="display: none;">
                <h4>é¸æ“‡æå‡æ©Ÿç‡çš„å€åŸŸ:</h4>
                <select id="boostTargetSelect"></select>
                <button onclick="applyBoost()">ç¢ºèªæå‡</button>
                <button onclick="cancelBoost()">å–æ¶ˆ</button>
            </div>
            <div class="card-selection-modal" id="removeTargetSelection" style="display: none;">
                <h4>é¸æ“‡è¦ç§»é™¤çš„å€åŸŸ:</h4>
                <select id="removeTargetSelect"></select>
                <button onclick="applyRemove()">ç¢ºèªç§»é™¤</button>
                <button onclick="cancelRemove()">å–æ¶ˆ</button>
            </div>
        </div>
        </div>

    <div class="confetti-container" id="confettiContainer"></div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <div class="modal-title">æ­å–œæ‚¨ï¼</div>
            <div id="finalResultText" class="modal-result-text"></div>
            <button class="modal-button" id="modalConfirmButton" onclick="closeModal()">ç¢ºèª</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        let centerX, centerY, radius;

        function setCanvasDimensions() {
            const canvasWidth = canvas.clientWidth;
            const canvasHeight = canvas.clientHeight;

            if (canvas.width !== canvasWidth || canvas.height !== canvasHeight) {
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
            }
            
            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
            radius = Math.min(centerX, centerY) * 0.8;
        }

        const entriesContainer = document.getElementById('entries');
        const spinButton = document.getElementById('spinButton');
        const spinCountInput = document.getElementById('spinCount');
        const spinDurationInput = document.getElementById('spinDuration');
        const confettiContainer = document.getElementById('confettiContainer');
        const resultModal = document.getElementById('resultModal');
        const finalResultText = document.getElementById('finalResultText');

        // === å¡ç‰‡ç›¸é—œ DOM å…ƒç´ å¼•ç”¨ ===
        const respinCardCountSpan = document.getElementById('respinCardCount');
        const boostCardCountSpan = document.getElementById('boostCardCount');
        const removeCardCountSpan = document.getElementById('removeCardCount');
        
        const boostTargetSelectionDiv = document.getElementById('boostTargetSelection');
        const boostTargetSelect = document.getElementById('boostTargetSelect');
        
        const removeTargetSelectionDiv = document.getElementById('removeTargetSelection');
        const removeTargetSelect = document.getElementById('removeTargetSelect');

        const modalConfirmButton = document.getElementById('modalConfirmButton'); 

        // å„²å­˜åŸå§‹çš„ entries ç‹€æ…‹ï¼Œä»¥ä¾¿åœ¨å¡ç‰‡æ•ˆæœçµæŸå¾Œæ¢å¾©
        let originalEntriesState = [];

        let cards = {
            respin: { count: 1, inUse: false },
            boost: { count: 1, inUse: false, boostedEntryId: null, originalBoostedValue: 0 }, 
            remove: { count: 1, inUse: false, removedEntryId: null, originalRemovedValue: 0 } 
        };

        let entries = []; 
        let isSpinning = false;
        let lastHighlightedSliceIndex = -1;
        let currentRotationOffset = 0; 

        const colors = [
            '#FF6347', '#4682B4', '#3CB371', '#FFD700', '#DA70D6',
            '#FFA07A', '#6A5ACD', '#7FFFD4', '#CD5C5C', '#F08080',
            '#87CEFA', '#90EE90', '#FFB6C1', '#DDA0DD', '#FFE4B5',
            '#ADD8E6', '#98FB98', '#FFC0CB', '#808000', '#A52A2A'
        ];

        function addEntry(defaultText = '', defaultValue = 10) {
            const index = entries.length;
            const newEntry = {
                value: defaultValue,
                text: defaultText,
                id: `entry-${Date.now()}-${index}`
            };
            entries.push(newEntry);
            saveOriginalEntriesState(); // æ¯æ¬¡æ–°å¢æˆ–åˆªé™¤æ™‚æ›´æ–°åŸå§‹ç‹€æ…‹
            renderEntry(newEntry);
            drawWheel();
            updateCardTargetSelects(); // çµ±ä¸€æ›´æ–°å¡ç‰‡ç›¸é—œçš„é¸æ“‡åˆ—è¡¨
        }

        function renderEntry(entry) {
            const entryDiv = document.createElement('div');
            entryDiv.className = 'entry-item';
            entryDiv.id = entry.id;

            entryDiv.innerHTML = `
                <label>æ•¸å€¼:</label>
                <input type="number" min="1" value="${entry.value}" onchange="updateEntry('${entry.id}', 'value', this.value)">
                <label>æ–‡å­—:</label>
                <input type="text" value="${entry.text}" onchange="updateEntry('${entry.id}', 'text', this.value)">
                <button onclick="removeEntry('${entry.id}')">åˆªé™¤</button>
            `;
            entriesContainer.appendChild(entryDiv);
        }

        function updateEntry(id, type, value) {
            const entryIndex = entries.findIndex(e => e.id === id);
            if (entryIndex > -1) {
                if (type === 'value') {
                    entries[entryIndex].value = Math.max(1, parseInt(value) || 1);
                } else if (type === 'text') {
                    entries[entryIndex].text = value;
                }
                saveOriginalEntriesState(); // æ¯æ¬¡æ›´æ–°æ™‚æ›´æ–°åŸå§‹ç‹€æ…‹
                drawWheel();
                updateCardTargetSelects();
            }
        }

        function removeEntry(id) {
            if (entries.length <= 1) {
                alert("è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹è½‰ç›¤å€åŸŸï¼");
                return;
            }
            entries = entries.filter(e => e.id !== id);
            document.getElementById(id).remove();
            saveOriginalEntriesState(); // æ¯æ¬¡æ–°å¢æˆ–åˆªé™¤æ™‚æ›´æ–°åŸå§‹ç‹€æ…‹
            drawWheel();
            updateCardTargetSelects();
        }

        // ç¹ªè£½è½‰ç›¤ï¼Œåªè€ƒæ…®æœ‰æ•ˆï¼ˆvalue > 0ï¼‰çš„å€åŸŸ
        function drawWheel(highlightIndex = -1) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const activeEntries = entries.filter(entry => entry.value > 0);
            const totalValue = activeEntries.reduce((sum, entry) => sum + entry.value, 0);

            if (totalValue === 0) {
                // å¦‚æœæ²’æœ‰æœ‰æ•ˆå€åŸŸï¼Œå¯ä»¥é¡¯ç¤ºä¸€å€‹æç¤ºæˆ–ä¿æŒç©ºç™½
                ctx.fillStyle = '#ccc';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.textAlign = "center";
                ctx.fillStyle = "#666";
                ctx.font = `bold ${radius * 0.1}px Arial`;
                ctx.fillText("ç„¡å¯é¸å€åŸŸ", centerX, centerY);
                return;
            }

            let currentAngleRad = -0.5 * Math.PI; 

            activeEntries.forEach((entry, i) => {
                const angleRad = (entry.value / totalValue) * Math.PI * 2; 
                const color = colors[i % colors.length];

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngleRad, currentAngleRad + angleRad);
                ctx.closePath();
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // åˆ¤æ–·æ˜¯å¦éœ€è¦é«˜äº®çš„æ˜¯é€™å€‹å¯¦éš›ç¹ªè£½çš„å€å¡Š
                const originalIndex = entries.findIndex(e => e.id === entry.id);
                if (originalIndex === highlightIndex) {
                    ctx.save();
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, currentAngleRad, currentAngleRad + angleRad);
                    ctx.closePath();
                    ctx.strokeStyle = 'gold';
                    ctx.lineWidth = 8;
                    ctx.stroke();
                    ctx.restore();
                }

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(currentAngleRad + angleRad / 2 + Math.PI / 2); 
                
                ctx.textAlign = "center"; 
                ctx.fillStyle = "white";

                let baseFontSize = radius * 0.08;
                let fontSize = Math.min(baseFontSize, 20);

                ctx.font = `bold ${fontSize}px Arial`;
                let textWidth = ctx.measureText(entry.text).width;
                const maxTextLength = radius * 0.6; 
                while (textWidth > maxTextLength && fontSize > (radius * 0.03)) {
                    fontSize--;
                    ctx.font = `bold ${fontSize}px Arial`;
                    textWidth = ctx.measureText(entry.text).width;
                }
                ctx.fillText(entry.text, 0, -radius * 0.7); 
                ctx.restore();

                currentAngleRad += angleRad; 
            });
        }

        function spinWheel() {
            if (isSpinning) return;

            // åªè€ƒæ…® value > 0 çš„ activeEntries ä¾†é€²è¡ŒæŠ½ç
            const activeEntries = entries.filter(entry => entry.value > 0);
            const totalValueActive = activeEntries.reduce((sum, entry) => sum + entry.value, 0);

            if (totalValueActive === 0) {
                alert("æ²’æœ‰å¯ä¾›æŠ½ççš„å€åŸŸï¼è«‹æª¢æŸ¥è½‰ç›¤å€åŸŸè¨­å®šã€‚");
                return;
            }

            isSpinning = true;
            spinButton.disabled = true;
            removeHighlight();
            closeModal();
            
            const spinCount = parseInt(spinCountInput.value) || 5;
            const spinDuration = parseFloat(spinDurationInput.value) || 5;

            const segmentAnglesDegrees = []; 
            let cumulativeAngle = 0; 
            const sectorData = []; 

            activeEntries.forEach((entry, i) => {
                const angle = (entry.value / totalValueActive) * 360; 
                const startAngle = cumulativeAngle;
                const endAngle = cumulativeAngle + angle;
                sectorData.push({ start: startAngle, end: endAngle, originalEntryId: entry.id }); // å„²å­˜åŸå§‹ entry çš„ ID
                segmentAnglesDegrees.push(angle);
                cumulativeAngle += angle;
            });

            let randomValue = Math.random() * totalValueActive; 
            let targetEntryId = null; 
            let currentCumulativeValue = 0;
            for (let i = 0; i < activeEntries.length; i++) { 
                currentCumulativeValue += activeEntries[i].value;
                if (randomValue < currentCumulativeValue) {
                    targetEntryId = activeEntries[i].id;
                    break;
                }
            }
            
            // æ‰¾åˆ°ç›®æ¨™å€å¡Šåœ¨ activeEntries ä¸­çš„å±€éƒ¨ç´¢å¼•ï¼Œç”¨æ–¼è¨ˆç®—è§’åº¦
            const targetLocalIndex = activeEntries.findIndex(e => e.id === targetEntryId);


            let targetCenterAngleOfSegment = 0;
            for (let i = 0; i < targetLocalIndex; i++) {
                targetCenterAngleOfSegment += segmentAnglesDegrees[i];
            }
            targetCenterAngleOfSegment += segmentAnglesDegrees[targetLocalIndex] / 2;

            let rotationNeededForAlignment = (360 - targetCenterAngleOfSegment) % 360;
            if (rotationNeededForAlignment < 0) rotationNeededForAlignment += 360;

            let finalRotationDegrees = currentRotationOffset + (spinCount * 360) + rotationNeededForAlignment;

            while (finalRotationDegrees <= currentRotationOffset + 360) {
                finalRotationDegrees += 360;
            }
            
            canvas.style.transition = 'none'; 
            canvas.style.transform = `rotate(${currentRotationOffset}deg)`;
            
            void canvas.offsetWidth; 
            
            const easeOutCubicBezier = 'cubic-bezier(0.1, 0.5, 0, 1)'; 

            canvas.style.setProperty('--spin-duration', `${spinDuration}s`);
            canvas.style.setProperty('--end-rotation', `${finalRotationDegrees}deg`);

            canvas.style.transition = `transform var(--spin-duration) ${easeOutCubicBezier}`;
            canvas.style.transform = `rotate(${finalRotationDegrees}deg)`;

            setTimeout(() => {
                isSpinning = false;
                spinButton.disabled = false;
                
                let actualStopAngle = finalRotationDegrees % 360;
                if (actualStopAngle < 0) actualStopAngle += 360;

                let winningEntryId = null; 
                let pointerRelativeAngle = (360 - actualStopAngle + 360) % 360; 

                for (let i = 0; i < sectorData.length; i++) {
                    const sector = sectorData[i];
                    if (pointerRelativeAngle >= sector.start && pointerRelativeAngle < sector.end) {
                        winningEntryId = sector.originalEntryId;
                        break;
                    }
                }
                
                // æ‰¾åˆ°ä¸­çå€å¡Šåœ¨åŸå§‹ `entries` ä¸­çš„ç´¢å¼•
                const winningEntryOriginalIndex = entries.findIndex(e => e.id === winningEntryId);

                // === è™•ç†å¡ç‰‡æ•ˆæœçµæŸèˆ‡æ¢å¾© ===
                // å…ˆæ¢å¾©åŸå§‹ç‹€æ…‹
                entries = JSON.parse(JSON.stringify(originalEntriesState));
                drawWheel(); // ç¹ªè£½æ¢å¾©å¾Œçš„è½‰ç›¤

                // é‡ç½®å¡ç‰‡ inUse ç‹€æ…‹å’Œç›¸é—œè®Šæ•¸
                cards.boost.inUse = false;
                cards.boost.boostedEntryId = null;
                cards.boost.originalBoostedValue = 0;

                cards.remove.inUse = false;
                cards.remove.removedEntryId = null;
                cards.remove.originalRemovedValue = 0;

                const resultText = entries[winningEntryOriginalIndex].text; 

                highlightSlice(winningEntryOriginalIndex);
                lastHighlightedSliceIndex = winningEntryOriginalIndex;

                // === è™•ç†é‡å•Ÿè½‰å‹•å¡æ•ˆæœ ===
                if (cards.respin.inUse) {
                    finalResultText.textContent = `æ‚¨æŠ½ä¸­äº†ï¼šã€${resultText}ã€ï¼\næ˜¯å¦ä½¿ç”¨ã€é‡å•Ÿè½‰å‹•å¡ã€å†è½‰ä¸€æ¬¡ï¼Ÿ`;
                    modalConfirmButton.textContent = 'å†è½‰ä¸€æ¬¡';
                    modalConfirmButton.onclick = () => {
                        closeModal(); 
                        spinWheel();  
                        cards.respin.inUse = false; // é‡å•Ÿè½‰å‹•å¡åœ¨é»æ“Šã€Œå†è½‰ä¸€æ¬¡ã€å¾Œæ‰ç®—å®Œå…¨æ¶ˆè€—
                        updateCardUI(); 
                        modalConfirmButton.textContent = 'ç¢ºèª'; 
                        modalConfirmButton.onclick = closeModal; 
                    };
                    showResultModal(resultText); 
                } else {
                    showResultModal(resultText);
                    throwConfetti();
                }
                // === é‡å•Ÿè½‰å‹•å¡æ•ˆæœçµæŸ ===

                currentRotationOffset = actualStopAngle; 
                canvas.style.transform = `rotate(${currentRotationOffset}deg)`;
                canvas.style.transition = 'none'; 
                
                updateCardUI(); // ç¢ºä¿æ‰€æœ‰å¡ç‰‡æŒ‰éˆ•ç‹€æ…‹æ›´æ–°
                updateCardTargetSelects(); // æ›´æ–°ä¸‹æ‹‰é¸å–®ä»¥åæ˜ æœ€æ–°entries
                
            }, spinDuration * 1000); 
        }

        function highlightSlice(index) {
            drawWheel(index);
        }

        function removeHighlight() {
            if (lastHighlightedSliceIndex !== -1) {
                drawWheel();
                lastHighlightedSliceIndex = -1;
            }
        }

        function throwConfetti() {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722', '#795548', '#9e9e9e', '#607d8b'];
            const numConfetti = 100;

            for (let i = 0; i < numConfetti; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confettiContainer.appendChild(confetti);

                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }
        }

        function showResultModal(resultText) {
            finalResultText.textContent = resultText;
            resultModal.style.display = 'flex';
        }

        function closeModal() {
            resultModal.style.display = 'none';
            modalConfirmButton.textContent = 'ç¢ºèª';
            modalConfirmButton.onclick = closeModal;
        }

        // === å¡ç‰‡åŠŸèƒ½ç›¸é—œå‡½æ•¸ ===

        // ä¿å­˜ç•¶å‰ entries çš„å‰¯æœ¬ä½œç‚ºåŸå§‹ç‹€æ…‹
        function saveOriginalEntriesState() {
            originalEntriesState = JSON.parse(JSON.stringify(entries));
        }

        // çµ±ä¸€æ›´æ–°æ‰€æœ‰å¡ç‰‡ç›¸é—œçš„é¸æ“‡åˆ—è¡¨
        function updateCardTargetSelects() {
            updateBoostTargetSelect();
            updateRemoveTargetSelect();
        }

        // æ›´æ–°å¡ç‰‡ UI (æ•¸é‡å’ŒæŒ‰éˆ•ç¦ç”¨ç‹€æ…‹)
        function updateCardUI() {
            respinCardCountSpan.textContent = cards.respin.count;
            boostCardCountSpan.textContent = cards.boost.count;
            removeCardCountSpan.textContent = cards.remove.count;
            
            const respinButton = document.querySelector('#respinCard .card-use-button');
            const boostButton = document.querySelector('#boostCard .card-use-button');
            const removeButton = document.querySelector('#removeCard .card-use-button');

            // ç¸½é«”ç¦ç”¨é‚è¼¯ï¼šå¦‚æœæ­£åœ¨æ—‹è½‰ï¼Œå‰‡ç¦ç”¨æ‰€æœ‰å¡ç‰‡
            if (isSpinning) {
                respinButton.disabled = true;
                boostButton.disabled = true;
                removeButton.disabled = true;
                return; // å¦‚æœæ­£åœ¨æ—‹è½‰ï¼Œç›´æ¥è¿”å›ï¼Œä¸åŸ·è¡Œå¾ŒçºŒç‰¹å®šå¡ç‰‡çš„ç¦ç”¨é‚è¼¯
            }

            // å€‹åˆ¥å¡ç‰‡ç¦ç”¨é‚è¼¯ï¼š
            // 1. å¡ç‰‡æ•¸é‡ç‚º 0
            // 2. æœ‰å…¶ä»–å¡ç‰‡æ­£åœ¨ä½¿ç”¨ (é˜²æ­¢åŒæ™‚å•Ÿç”¨å¤šå€‹æ•ˆæœ)
            respinButton.disabled = cards.respin.count === 0 || cards.boost.inUse || cards.remove.inUse;
            boostButton.disabled = cards.boost.count === 0 || cards.respin.inUse || cards.remove.inUse;
            removeButton.disabled = cards.remove.count === 0 || cards.respin.inUse || cards.boost.inUse;
        }

        // é‡ç½®æ‰€æœ‰å¡ç‰‡æ•¸é‡å’Œç‹€æ…‹
        function resetCards() {
            cards.respin.count = 1;
            cards.respin.inUse = false;
            
            cards.boost.count = 1;
            cards.boost.inUse = false;
            cards.boost.boostedEntryId = null;
            cards.boost.originalBoostedValue = 0;
            boostTargetSelectionDiv.style.display = 'none';

            cards.remove.count = 1;
            cards.remove.inUse = false;
            cards.remove.removedEntryId = null;
            cards.remove.originalRemovedValue = 0;
            removeTargetSelectionDiv.style.display = 'none';

            // å°‡ entries æ¢å¾©åˆ°æœ€è¿‘ä¸€æ¬¡ä¿å­˜çš„åŸå§‹ç‹€æ…‹ (åœ¨ä»»ä½•å¡ç‰‡ä½¿ç”¨å‰æˆ–åœ¨æ–°å¢/åˆªé™¤å€åŸŸå¾Œ)
            entries = JSON.parse(JSON.stringify(originalEntriesState));
            drawWheel(); 
            updateCardUI(); 
            updateCardTargetSelects(); // é‡ç½®å¾Œï¼Œä¹Ÿæ›´æ–°ä¸‹æ‹‰é¸å–®
            alert("æ‰€æœ‰åŠŸèƒ½å¡ç‰‡å·²é‡ç½®ï¼");
        }


        // --- é‡å•Ÿè½‰å‹•å¡ ---
        function useRespinCard() {
            if (cards.respin.count > 0 && !isSpinning && !cards.boost.inUse && !cards.remove.inUse) {
                cards.respin.inUse = true;
                cards.respin.count--; // ç«‹å³æ¸›å°‘å¡ç‰‡æ•¸é‡
                updateCardUI();
                alert("æ‚¨å·²ä½¿ç”¨ã€é‡å•Ÿè½‰å‹•å¡ã€ï¼Œä¸‹æ¬¡è½‰å‹•å¾Œå°‡æœ‰æ©Ÿæœƒå†è½‰ä¸€æ¬¡ï¼");
            } else if (cards.respin.count === 0) {
                 alert("ã€é‡å•Ÿè½‰å‹•å¡ã€å·²ä½¿ç”¨å®Œç•¢ï¼è«‹é»æ“Šã€é‡ç½®å¡ç‰‡ã€æ¢å¾©ã€‚");
            } else {
                 alert("è«‹ç­‰å¾…ç•¶å‰æ“ä½œçµæŸæˆ–è½‰ç›¤åœæ­¢ï¼Œæˆ–æœ‰å…¶ä»–å¡ç‰‡æ­£åœ¨ä½¿ç”¨ã€‚");
            }
        }

        // --- æ©Ÿç‡æå‡å¡ ---
        function updateBoostTargetSelect() {
            boostTargetSelect.innerHTML = ''; 
            // ç¯©é¸å‡ºç•¶å‰å¯ä¾›é¸æ“‡çš„å€å¡Šï¼ˆæœªè¢«åˆªé™¤å¡ç§»é™¤çš„ï¼‰
            const availableEntries = entries.filter(entry => entry.value > 0);
            availableEntries.forEach(entry => {
                const option = document.createElement('option');
                option.value = entry.id;
                option.textContent = entry.text || `å€åŸŸ ${entry.id.split('-').pop()}`;
                boostTargetSelect.appendChild(option);
            });
            document.querySelector('#boostTargetSelection button:first-of-type').disabled = availableEntries.length === 0;
        }

        function useBoostCard() {
            if (cards.boost.count > 0 && !isSpinning && !cards.respin.inUse && !cards.remove.inUse) {
                const availableEntries = entries.filter(entry => entry.value > 0);
                if (availableEntries.length === 0) {
                    alert("æ²’æœ‰å¯æå‡æ©Ÿç‡çš„å€åŸŸï¼Œè«‹ç¢ºèªè½‰ç›¤è¨­å®šã€‚");
                    return;
                }

                cards.boost.inUse = true;
                cards.boost.count--; // ç«‹å³æ¸›å°‘å¡ç‰‡æ•¸é‡
                
                boostTargetSelectionDiv.style.display = 'block';
                updateBoostTargetSelect(); 
                updateCardUI(); 
            } else if (cards.boost.count === 0) {
                alert("ã€æ©Ÿç‡æå‡å¡ã€å·²ä½¿ç”¨å®Œç•¢ï¼è«‹é»æ“Šã€é‡ç½®å¡ç‰‡ã€æ¢å¾©ã€‚");
            } else {
                alert("è«‹ç­‰å¾…ç•¶å‰æ“ä½œçµæŸæˆ–è½‰ç›¤åœæ­¢ï¼Œæˆ–æœ‰å…¶ä»–å¡ç‰‡æ­£åœ¨ä½¿ç”¨ã€‚");
            }
        }

        function applyBoost() {
            const selectedId = boostTargetSelect.value;
            if (!selectedId) {
                alert("è«‹é¸æ“‡ä¸€å€‹å€åŸŸä¾†æå‡æ©Ÿç‡ï¼");
                return;
            }

            cards.boost.boostedEntryId = selectedId;
            const entry = entries.find(e => e.id === cards.boost.boostedEntryId);
            if (entry) {
                cards.boost.originalBoostedValue = entry.value; // å„²å­˜åŸå§‹å€¼
                entry.value *= 2; // æå‡æ©Ÿç‡ (å€æ•¸å¯ä»¥è‡ªè¨‚)
                drawWheel(); 
            }
            
            boostTargetSelectionDiv.style.display = 'none'; 
            updateCardUI(); 
            alert(`æ‚¨å·²ä½¿ç”¨ã€æ©Ÿç‡æå‡å¡ã€ï¼Œå€åŸŸ "${entry ? entry.text : 'æœªçŸ¥'}" çš„æ©Ÿç‡å·²æå‡ï¼\næ­¤æ¬¡æ—‹è½‰çµæŸå¾Œå°‡æ¢å¾©ã€‚`);
        }

        function cancelBoost() {
            // å¦‚æœå–æ¶ˆï¼Œå°‡å¡ç‰‡æ•¸é‡æ¢å¾©
            if (cards.boost.inUse) {
                cards.boost.count++; 
            }
            cards.boost.inUse = false; 
            if (cards.boost.boostedEntryId && cards.boost.originalBoostedValue > 0) {
                const entry = entries.find(e => e.id === cards.boost.boostedEntryId);
                if (entry) {
                    entry.value = cards.boost.originalBoostedValue; // æ¢å¾©åŸå§‹å€¼
                }
            }
            cards.boost.boostedEntryId = null; 
            cards.boost.originalBoostedValue = 0;
            drawWheel(); 
            boostTargetSelectionDiv.style.display = 'none'; 
            updateCardUI(); 
        }

        // --- åˆªé™¤å€å¡Šå¡ ---
        function updateRemoveTargetSelect() {
            removeTargetSelect.innerHTML = '';
            // ç¯©é¸å‡ºç•¶å‰å¯ä¾›é¸æ“‡çš„å€å¡Šï¼ˆæœªè¢«æå‡å¡å½±éŸ¿ï¼Œä¸”éç•¶å‰è¢«ç§»é™¤çš„ï¼Œä¸”ç¢ºä¿ç§»é™¤å¾Œä»æœ‰è‡³å°‘ä¸€å€‹å¯æŠ½çå€å¡Šï¼‰
            const availableEntries = entries.filter(entry => {
                // ä¸èƒ½æ˜¯ç•¶å‰å·²ç¶“è¢«ç§»é™¤çš„å€å¡Šï¼ˆå„˜ç®¡å¡ç‰‡è¨­è¨ˆæ˜¯å–®æ¬¡ï¼Œä½†ä»¥é˜²è¬ä¸€ï¼‰
                if (entry.id === cards.remove.removedEntryId) return false;
                // æ’é™¤è¢« boost æå‡çš„å€å¡Šï¼Œé¿å…è¡çª
                if (entry.id === cards.boost.boostedEntryId) return false;
                
                // ç¢ºä¿ç§»é™¤å¾Œè‡³å°‘é‚„å‰©ä¸‹ä¸€å€‹ value > 0 çš„å€å¡Šå¯ä¾›æŠ½ç
                const tempEntries = JSON.parse(JSON.stringify(entries)); // è¤‡è£½ä¸€ä»½
                const tempRemovedIndex = tempEntries.findIndex(e => e.id === entry.id);
                if (tempRemovedIndex > -1) {
                    tempEntries[tempRemovedIndex].value = 0; // æ¨¡æ“¬ç§»é™¤
                }
                const remainingActive = tempEntries.filter(e => e.value > 0);
                return remainingActive.length > 0;
            });
            
            availableEntries.forEach(entry => {
                const option = document.createElement('option');
                option.value = entry.id;
                option.textContent = entry.text || `å€åŸŸ ${entry.id.split('-').pop()}`;
                removeTargetSelect.appendChild(option);
            });
            document.querySelector('#removeTargetSelection button:first-of-type').disabled = availableEntries.length === 0;
        }

        function useRemoveCard() {
            if (cards.remove.count > 0 && !isSpinning && !cards.respin.inUse && !cards.boost.inUse) {
                // ç¢ºä¿æœ‰è¶³å¤ çš„å€å¡Šå¯ä»¥ç§»é™¤ï¼Œè‡³å°‘éœ€è¦2å€‹æ´»è‘—çš„å€å¡Š
                const activeEntriesCount = entries.filter(e => e.value > 0).length;
                if (activeEntriesCount < 2) {
                    alert("è‡³å°‘éœ€è¦å…©å€‹æœ‰æ•ˆçš„è½‰ç›¤å€åŸŸæ‰èƒ½ä½¿ç”¨ã€åˆªé™¤å€å¡Šå¡ã€ã€‚");
                    return;
                }

                cards.remove.inUse = true;
                cards.remove.count--; // ç«‹å³æ¸›å°‘å¡ç‰‡æ•¸é‡

                removeTargetSelectionDiv.style.display = 'block';
                updateRemoveTargetSelect(); 
                updateCardUI(); 
            } else if (cards.remove.count === 0) {
                 alert("ã€åˆªé™¤å€å¡Šå¡ã€å·²ä½¿ç”¨å®Œç•¢ï¼è«‹é»æ“Šã€é‡ç½®å¡ç‰‡ã€æ¢å¾©ã€‚");
            } else {
                 alert("è«‹ç­‰å¾…ç•¶å‰æ“ä½œçµæŸæˆ–è½‰ç›¤åœæ­¢ï¼Œæˆ–æœ‰å…¶ä»–å¡ç‰‡æ­£åœ¨ä½¿ç”¨ã€‚");
            }
        }

        function applyRemove() {
            const selectedId = removeTargetSelect.value;
            if (!selectedId) {
                alert("è«‹é¸æ“‡ä¸€å€‹å€åŸŸä¾†ç§»é™¤ï¼");
                return;
            }

            cards.remove.removedEntryId = selectedId;
            const entry = entries.find(e => e.id === cards.remove.removedEntryId);
            if (entry) {
                cards.remove.originalRemovedValue = entry.value; // å„²å­˜åŸå§‹å€¼
                entry.value = 0; // å°‡è©²å€å¡Šçš„æ¬Šé‡è¨­ç‚º0ï¼Œä½¿å…¶ä¸è¢«æŠ½ä¸­ï¼Œä¹Ÿä¸åƒèˆ‡ç¹ªè£½
                drawWheel(); // é‡æ–°ç¹ªè£½è½‰ç›¤ï¼Œç©ºç™½å€åŸŸæœƒæ¶ˆå¤±ï¼Œå…¶ä»–å€åŸŸé‡æ–°åˆ†é…ç©ºé–“
            }
            
            removeTargetSelectionDiv.style.display = 'none'; 
            updateCardUI(); 
            alert(`æ‚¨å·²ä½¿ç”¨ã€åˆªé™¤å€å¡Šå¡ã€ï¼Œå€åŸŸ "${entry ? entry.text : 'æœªçŸ¥'}" å·²æš«æ™‚ç§»é™¤ï¼\næ­¤æ¬¡æ—‹è½‰çµæŸå¾Œå°‡æ¢å¾©ã€‚`);
        }

        function cancelRemove() {
            // å¦‚æœå–æ¶ˆï¼Œå°‡å¡ç‰‡æ•¸é‡æ¢å¾©
            if (cards.remove.inUse) {
                cards.remove.count++; 
            }
            cards.remove.inUse = false; 
            if (cards.remove.removedEntryId && cards.remove.originalRemovedValue > 0) {
                const entry = entries.find(e => e.id === cards.remove.removedEntryId);
                if (entry) {
                    entry.value = cards.remove.originalRemovedValue; // æ¢å¾©åŸå§‹å€¼
                }
            }
            cards.remove.removedEntryId = null; 
            cards.remove.originalRemovedValue = 0;
            drawWheel(); 
            removeTargetSelectionDiv.style.display = 'none'; 
            updateCardUI(); 
        }

        // === å¡ç‰‡åŠŸèƒ½ç›¸é—œå‡½æ•¸çµæŸ ===


        // åˆå§‹åŒ–è½‰ç›¤å€åŸŸ
        function initializeEntries() {
            entries = []; 
            entriesContainer.innerHTML = ''; 

            addEntry('æ­å–œç™¼è²¡', 20);
            addEntry('äº‹äº‹é †åˆ©', 30);
            addEntry('å­¸æ¥­é€²æ­¥', 25);
            addEntry('å¤©å¤©é–‹å¿ƒ', 25);
            
            saveOriginalEntriesState(); // ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ™‚ä¿å­˜åŸå§‹ç‹€æ…‹
            updateCardUI(); 
        }

        // äº‹ä»¶ç›£è½å™¨
        spinButton.addEventListener('click', spinWheel);

        window.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && resultModal.style.display === 'flex') {
                closeModal();
            }
        });

        window.addEventListener('click', (event) => {
            if (event.target === resultModal) { 
                closeModal();
            }
        });

        window.addEventListener('resize', () => {
            setCanvasDimensions();
            drawWheel();
            updateCardTargetSelects(); 
        });

        // é é¢åŠ è¼‰å®Œæˆå¾ŒåŸ·è¡Œåˆå§‹åŒ–
        window.onload = () => {
            setCanvasDimensions(); 
            initializeEntries(); 
        };
    </script>

</body>
</html>
